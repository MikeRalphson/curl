#!/usr/bin/env perl

$version = $ARGV[0];

if($version eq "") {
    print "Enter version number!\n";
    exit;
}

if(!-f "ares.h") {
    print "run this script in the ares source root dir\n";
    exit;
}

if(!-f "configure") {
    print "running buildconf\n";
    `./buildconf`;
}
print "adding $version in the configure.ac file\n";
`sed -e 's/AM_INIT_AUTOMAKE(c-ares, CVS)/AM_INIT_AUTOMAKE(c-ares, $version)/' < configure.ac > configure.ac-rel`;

# now make a new configure script with this
print "makes a new configure script\n";
`autoconf configure.ac-rel`;

# now run this new configure to get a fine makefile
print "running configure\n";
`./configure`;

# now make the actual tarball
print "running make dist\n";
`make dist`;

print "removing temporary configure.ac file\n";
`rm configure.ac-rel`;

print "NOTE: now cvs tag this release!\n";
